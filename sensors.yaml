#  - platform: influxdb
#    host: !secret influxdb_host
#    port: !secret influxdb_port
#    username: !secret influxdb_user
#    password: !secret influxdb_pass
#    queries:
#      - name: Discovergy Phase 1 Max
#        unit_of_measurement: 'W'
#        value_template: '{{ value | round(1) }}'
#        group_function: max
#        where: '"entity_id" = ''discovergy_phase1'' and time > now() -8h'
#        measurement: '"W"'
#        field: value
#        database: !secret influxdb_database

  - platform: mqtt
    name: "Discovergy power"
    state_topic: "discovergy/meter_power" 
    unit_of_measurement: "W"
  - platform: mqtt
    name: "Discovergy energy"
    state_topic: "discovergy/meter_energy" 
    unit_of_measurement: "kWh"
  - platform: mqtt
    name: "Discovergy Phase1"
    state_topic: "discovergy/meter_power_phase1"
    unit_of_measurement: "W"
  - platform: mqtt
    name: "Discovergy Phase2"
    state_topic: "discovergy/meter_power_phase2"
    unit_of_measurement: "W"
  - platform: mqtt
    name: "Discovergy Phase3"
    state_topic: "discovergy/meter_power_phase3"
    unit_of_measurement: "W"

  - platform: mqtt
    name: "Outside Temperatur"
    unit_of_measurement: 'Â°C'
    state_topic: "domoticz/out/Haus/homeassistant"
    value_template: '{{ value_json.svalue1 }}'
  - platform: mqtt
    name: "Outside Humidity"
    unit_of_measurement: '%'
    state_topic: "domoticz/out/Haus/homeassistant"
    value_template: '{{ value_json.svalue2 }}'

    #  - platform: rest
    #    resource: http://127.0.0.1:8080/json.htm?type=devices&rid=372
    #    name: rts_schlafen
    #    value_template: '{{ value_json.result[0].Status  }}'
    #  - platform: rest
    #    resource: http://127.0.0.1:8080/json.htm?type=devices&rid=373
    #    name: rts_arbeiten
    #    value_template: '{{ value_json.result[0].Status  }}'
    #  - platform: rest
    #    resource: http://127.0.0.1:8080/json.htm?type=devices&rid=374
    #    name: rts_stern
    #    value_template: '{{ value_json.result[0].Status  }}'
### Rollos    
#  - platform: rest
#    resource: http://127.0.0.1:8080/json.htm?type=devices&rid=1727
#    name: rts_rollo1
#    value_template: '{{ value_json.result[0].Status  }}'
#  - platform: rest
#    resource: http://127.0.0.1:8080/json.htm?type=devices&rid=1734
#    name: rts_rollo2
#    value_template: '{{ value_json.result[0].Status  }}'
#  - platform: rest
#    resource: http://127.0.0.1:8080/json.htm?type=devices&rid=1729
#    name: rts_rollo3
#    value_template: '{{ value_json.result[0].Status  }}'
#  - platform: rest
#    resource: http://127.0.0.1:8080/json.htm?type=devices&rid=1730
#    name: rts_rollo4
#    value_template: '{{ value_json.result[0].Status  }}'
#  - platform: rest
#    resource: http://127.0.0.1:8080/json.htm?type=devices&rid=1726
#    name: rts_rollo5
#    value_template: '{{ value_json.result[0].Status  }}'


    #  - platform: rfxtrx
    #automatic_add: True
    # devices:
    #  08500207640100ac40:
    #    name: rfxtrx_Temp1
    #    data_type: 
    #      - Temperature
    #  0a5207013c0e00b33b0159:
    #    name: rfxtrx_Temp2
    #    data_type:
    #      - Temperature
    #      - Humidity
    #  0a520302e60100e7120249:
    #    name: rfxtrx_Temp3
    #    data_type:
    #      - Temperature

  - platform: time_date
    display_options:
      - 'date_time'
      - 'time_date'
      - 'beat'
  - platform: template
    sensors:
      technik_temp:
        value_template: '{{ states.switch.fritzdect_200_1.attributes.temperature }}'
        friendly_name: 'Temperatur Technikraum'
        unit_of_measurement: 'C'
      technik_power:
        value_template: '{{ states.switch.fritzdect_200_1.attributes.current_consumption }}'
        friendly_name: 'Enfeuchter Power'
        unit_of_measurement: 'W'
      technik_total_power:
        value_template: '{{ states.switch.fritzdect_200_1.attributes.total_consumption }}'
        friendly_name: 'Enfeuchter Energy'
        unit_of_measurement: 'kWh'
#      rts_schlafen_status:
#        value_template: '{{ states.sensor.rts_schlafen.result["Status"] }}'


  - platform: fritzbox_netmonitor
    host: !secret fritz_host
    resources:
      - type: is_linked
      - type: is_connected
      - type: wan_access_type
      - type: external_ip
      - type: uptime
      - type: bytes_sent
      - type: bytes_received
      - type: transmission_rate_up
      - type: transmission_rate_down
      - type: max_byte_rate_up
      - type: max_byte_rate_down
      - type: max_bit_rate_up
      - type: max_bit_rate_down
#    username: !secret fritz_username
#    password: !secret fritz_password

  - platform: systemmonitor
    resources:
      - type: disk_use_percent
        arg: /home
      - type: processor_use
      - type: memory_use_percent
      - type: last_boot
      - type: since_last_boot

  - platform: speedtest
    minute:
      - 0
      - 15
    monitored_conditions:
      - download
      - upload
      - ping
  - platform: template
    sensors:
      since_last_boot_templated:
        value_template: >-
          {%- set slb = states.sensor.since_last_boot.state.split(' ') -%}
          {%- set count = slb | length -%}
          {%- set hms = slb[count - 1] -%}
          {%- set hms_trimmed = hms.split('.')[0] -%}
          {%- set hms_split = hms_trimmed.split(':') -%}
          {%- set hours = hms_split[0] | int -%}
          {%- if count == 3 -%}
            {{ slb[0] ~ ' ' ~ slb[1] ~ ' ' }}
          {%- endif -%}
          {%- if hours > 0 -%}
            {%- if hours == 1 -%}
              1 hour
            {%- else -%}
              {{ hours }} hours
            {%- endif -%}
          {%- endif -%}

  - platform: version
    name: Installed Version

  - platform: scrape
    resource: https://www.home-assistant.io
    name: Latest Release
    select: ".current-version h1"
    value_template: '{{ value.split(":")[1] }}'

#  - platform: synologydsm
#    host: !secret syno_host
#    username: !secret syno_user
#    password: !secret syno_pass
#    monitored_conditions:
#      - cpu_total_load
#      - memory_real_usage
#      - network_up
#      - disk_smart_status
#      - volume_size_total
#      - volume_size_used

